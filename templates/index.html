<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<!-- <meta http-equiv="refresh" content="5; URL=https://sheltered-coast-93272.herokuapp.com/"> -->
	<!-- <meta http-equiv="refresh" content="5; URL=http://127.0.0.1:8000/"> -->

	<title>Graph</title>
	{% block scripts %}
		<script src="{{ url_for('static', filename='plotly-latest.min.js') }}"></script>
	{% endblock %}

	{% block stylesheets %}
		<link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
		<link rel="stylesheet" href="{{url_for('static', filename='bootstrap-4.3.1.min.css')}}">
	{% endblock %}
</head>
<body>
	
	<div class="container">
		<div class="row">
			<div class="col"></div>
			<div class="col-auto">
				<p id="x-value">{{ xa }}</p>
				<p id="y-value">{{ ya }}</p>
				<div id="test" style="width: 800px;height: 400px"></div>
			</div>
			<div class="col"></div>
		</div>
	</div>
	<script>
		test = document.getElementById('test');
		var x = document.getElementById("x-value").innerHTML;
		var y = document.getElementById("y-value").innerHTML;
		console.log(x)
		var regPat = /[0-9][.][0-9]+/g;
		x_str = x.match(regPat);
		y_str = y.match(regPat);

		console.log(x_str);
		console.log(y_str);


		var plotTime = new Date();
		var plotData = [{
			x: [plotTime],
			y: [y_str],
			mode: 'lines',
			line: {
				color: '#80CAF6'
			}
		}]
		var plotLayout = [{
			yaxis: {
				title: "y axis title"
			},
			xaxis: {
				title: "x axis title"
			}
		}]

		Plotly.newPlot(test, plotData, plotLayout);

		var count = 0;

		var plotInterval = setInterval(function(){
			var nPTime = new Date();

			var pltUpdate = {
				x: [[nPTime]]
			}

			Plotly.extendTraces(test, pltUpdate, [0])

			if(count === 1000) clearInterval(plotInterval);
		}, 10000);

		// Plotly.newPlot(test, [{
		// 	x: x_str,
		// 	y: , 
		// }], {
		// 	margin: {
		// 		t: 0
		// 	},
		// 	yaxis: {
		// 		tickformat: '%H:%M:%S',
		// 		title: 'yaxis title'
		// 	},
		// 	xaxis: {
		// 		title: 'xaxis title'
		// 	}
		// })

		function randomize() {
		  Plotly.animate(test, {
		    data: [{y: [Math.random(), Math.random(), Math.random()]}],
		    traces: [0],
		    layout: {}
		  }, {
		    transition: {
		      duration: 500,
		      easing: 'cubic-in-out'
		    },
		    frame: {
		      duration: 500
		    }
		  })
		}

		function sec2dt(v) {
		  var MIN = 60
		  var HOUR = 60 * 60
		  
		  var h = Math.floor(v / HOUR)
		  var m =  Math.floor((v - (h * HOUR)) / MIN)
		  var s = Math.floor(v - (h * HOUR) - (m * MIN))

		  // you have to provide YYYY-MM-DD
		  // for plotly to understand it as a date
		  return `2017-01-01 ${h}:${pad(m)}:${pad(s)}`
		}

		function pad(v) {
		  return v < 10 ? '0' + v : String(v)
		}
		
		// var clr = setInterval(clearArray(), 8000);
		// function clearArray(){
		// 	y_str.pop();
		// 	x_str.pop();
		// 	console.log("x after: " + x_str);
		// 	console.log("y after: " + y_str);
		// }
	</script>

	<script>

		// if ('serviceWorker' in navigator) {
		// 	window.addEventListener('load', function() {
		// 		navigator.serviceWorker.register('/sw.js').then(function(registration) {
		// 			console.log('ServiceWorker registration successful with scope: ', registration.scope);
		// 		}, function(err) {
		// 			console.log('ServiceWorker registration failed: ', err);
		// 		})
		// 	})
		// }
	</script>
</body>
</html>